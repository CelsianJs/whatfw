<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>What Framework vs React — Performance Benchmark</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #08090d;
  --bg-card: #111319;
  --border: #1e2130;
  --text: #e8eaf0;
  --text-dim: #7a7f99;
  --accent: #3b7aff;
  --green: #22c55e;
  --red: #ef4444;
  --amber: #f59e0b;
  --font: 'Outfit', sans-serif;
  --mono: 'JetBrains Mono', monospace;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font);
  line-height: 1.6;
  padding: 40px 24px;
  max-width: 1000px;
  margin: 0 auto;
}

h1 {
  font-size: 32px;
  font-weight: 800;
  margin-bottom: 8px;
  letter-spacing: -0.02em;
}

h1 span { color: var(--accent); }

.subtitle {
  color: var(--text-dim);
  margin-bottom: 32px;
  font-size: 15px;
}

.controls {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}

button {
  font-family: var(--font);
  font-weight: 600;
  padding: 10px 20px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text);
  cursor: pointer;
  font-size: 14px;
  transition: all 0.15s;
}

button:hover { border-color: var(--accent); color: var(--accent); }
button:disabled { opacity: 0.4; cursor: not-allowed; }
button.primary { background: var(--accent); border-color: var(--accent); color: white; }
button.primary:hover { background: #2a6ae8; }

.progress-bar {
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  margin-bottom: 24px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--accent);
  border-radius: 2px;
  transition: width 0.3s;
  width: 0%;
}

.status {
  color: var(--text-dim);
  margin-bottom: 24px;
  font-size: 14px;
  font-family: var(--mono);
  min-height: 20px;
}

/* Results table */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

thead th {
  text-align: left;
  padding: 12px 16px;
  border-bottom: 2px solid var(--border);
  font-weight: 600;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-dim);
}

thead th:nth-child(2), thead th:nth-child(3), thead th:nth-child(4) {
  text-align: right;
}

tbody td {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
}

tbody td:nth-child(2), tbody td:nth-child(3), tbody td:nth-child(4) {
  text-align: right;
  font-family: var(--mono);
  font-size: 13px;
}

.test-name {
  font-weight: 500;
}

.test-desc {
  color: var(--text-dim);
  font-size: 12px;
  margin-top: 2px;
}

.faster { color: var(--green); font-weight: 600; }
.slower { color: var(--red); font-weight: 600; }
.neutral { color: var(--amber); }

.bar-cell {
  position: relative;
  min-width: 200px;
}

.bar-track {
  display: flex;
  gap: 2px;
  align-items: center;
  height: 24px;
}

.bar {
  height: 100%;
  border-radius: 3px;
  min-width: 2px;
  transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1);
}

.bar.what { background: var(--accent); }
.bar.react { background: #61dafb40; border: 1px solid #61dafb; }

.legend {
  display: flex;
  gap: 20px;
  margin-bottom: 24px;
  font-size: 13px;
  color: var(--text-dim);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.legend-dot {
  width: 12px;
  height: 12px;
  border-radius: 3px;
}

.legend-dot.what { background: var(--accent); }
.legend-dot.react { background: #61dafb40; border: 1px solid #61dafb; }

.iframes {
  display: none;
}

.summary {
  margin-top: 32px;
  padding: 24px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
}

.summary h3 {
  font-size: 18px;
  margin-bottom: 12px;
}

.summary-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
}

.stat-card {
  text-align: center;
}

.stat-value {
  font-size: 28px;
  font-weight: 800;
  font-family: var(--mono);
}

.stat-label {
  font-size: 12px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
</style>
</head>
<body>

<h1>What Framework <span>vs</span> React</h1>
<p class="subtitle">Head-to-head performance comparison — signals vs virtual DOM</p>

<div class="controls">
  <button class="primary" id="runAll" onclick="runAllBenchmarks()">Run All Benchmarks</button>
  <button id="runSingle" onclick="runSingleTest('create1k')">Create 1K</button>
  <button id="runSingle" onclick="runSingleTest('update10k')">Update 10K</button>
  <button id="runSingle" onclick="runSingleTest('select')">Select Row</button>
  <button id="runSingle" onclick="runSingleTest('replace')">Replace All</button>
  <button id="runSingle" onclick="runSingleTest('swap')">Swap Rows</button>
  <button id="runSingle" onclick="runSingleTest('clear')">Clear</button>
</div>

<div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
<div class="status" id="status"></div>

<div class="legend">
  <div class="legend-item"><div class="legend-dot what"></div>What Framework</div>
  <div class="legend-item"><div class="legend-dot react"></div>React</div>
  <div class="legend-item" style="margin-left: auto; font-family: var(--mono);">Lower is better (ms)</div>
</div>

<table>
  <thead>
    <tr>
      <th>Test</th>
      <th>What (ms)</th>
      <th>React (ms)</th>
      <th>Speedup</th>
      <th style="min-width: 240px">Comparison</th>
    </tr>
  </thead>
  <tbody id="results">
    <tr id="row-create1k">
      <td><div class="test-name">Create 1,000 rows</div><div class="test-desc">Initial render from empty</div></td>
      <td class="what-val">—</td>
      <td class="react-val">—</td>
      <td class="speedup">—</td>
      <td class="bar-cell"><div class="bar-track"><div class="bar what" style="width:0"></div><div class="bar react" style="width:0"></div></div></td>
    </tr>
    <tr id="row-replace">
      <td><div class="test-name">Replace 1,000 rows</div><div class="test-desc">Clear + create new data</div></td>
      <td class="what-val">—</td>
      <td class="react-val">—</td>
      <td class="speedup">—</td>
      <td class="bar-cell"><div class="bar-track"><div class="bar what" style="width:0"></div><div class="bar react" style="width:0"></div></div></td>
    </tr>
    <tr id="row-update10k">
      <td><div class="test-name">Partial update (10K)</div><div class="test-desc">Update every 10th row of 10,000</div></td>
      <td class="what-val">—</td>
      <td class="react-val">—</td>
      <td class="speedup">—</td>
      <td class="bar-cell"><div class="bar-track"><div class="bar what" style="width:0"></div><div class="bar react" style="width:0"></div></div></td>
    </tr>
    <tr id="row-select">
      <td><div class="test-name">Select row</div><div class="test-desc">Toggle selection on 1,000 rows</div></td>
      <td class="what-val">—</td>
      <td class="react-val">—</td>
      <td class="speedup">—</td>
      <td class="bar-cell"><div class="bar-track"><div class="bar what" style="width:0"></div><div class="bar react" style="width:0"></div></div></td>
    </tr>
    <tr id="row-swap">
      <td><div class="test-name">Swap rows</div><div class="test-desc">Swap rows at index 1 and 998</div></td>
      <td class="what-val">—</td>
      <td class="react-val">—</td>
      <td class="speedup">—</td>
      <td class="bar-cell"><div class="bar-track"><div class="bar what" style="width:0"></div><div class="bar react" style="width:0"></div></div></td>
    </tr>
    <tr id="row-clear">
      <td><div class="test-name">Clear 1,000 rows</div><div class="test-desc">Remove all rows</div></td>
      <td class="what-val">—</td>
      <td class="react-val">—</td>
      <td class="speedup">—</td>
      <td class="bar-cell"><div class="bar-track"><div class="bar what" style="width:0"></div><div class="bar react" style="width:0"></div></div></td>
    </tr>
    <tr id="row-create10k">
      <td><div class="test-name">Create 10,000 rows</div><div class="test-desc">Stress test — large initial render</div></td>
      <td class="what-val">—</td>
      <td class="react-val">—</td>
      <td class="speedup">—</td>
      <td class="bar-cell"><div class="bar-track"><div class="bar what" style="width:0"></div><div class="bar react" style="width:0"></div></div></td>
    </tr>
    <tr id="row-append">
      <td><div class="test-name">Append 1,000 to 10K</div><div class="test-desc">Add rows to large existing table</div></td>
      <td class="what-val">—</td>
      <td class="react-val">—</td>
      <td class="speedup">—</td>
      <td class="bar-cell"><div class="bar-track"><div class="bar what" style="width:0"></div><div class="bar react" style="width:0"></div></div></td>
    </tr>
  </tbody>
</table>

<div class="summary" id="summary" style="display: none">
  <h3>Results Summary</h3>
  <div class="summary-stats">
    <div class="stat-card">
      <div class="stat-value faster" id="avg-speedup">—</div>
      <div class="stat-label">Average Speedup</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="tests-won">—</div>
      <div class="stat-label">Tests Won by What</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="max-speedup">—</div>
      <div class="stat-label">Best Speedup</div>
    </div>
  </div>
</div>

<div class="iframes">
  <iframe id="whatFrame" src="./index.html" width="800" height="600"></iframe>
  <iframe id="reactFrame" src="./react.html" width="800" height="600"></iframe>
</div>

<script>
const WARMUP_RUNS = 3;
const MEASURED_RUNS = 5;
const results = {};

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

function getFrame(name) {
  return document.getElementById(name + 'Frame').contentWindow;
}

async function waitForBench(frame, timeout = 10000) {
  const start = Date.now();
  while (!frame._bench && Date.now() - start < timeout) {
    await sleep(50);
  }
  if (!frame._bench) throw new Error('Benchmark API not found');
  return frame._bench;
}

async function measureOp(frame, setup, action, teardown) {
  if (setup) await setup(frame._bench);
  await sleep(16); // let browser settle

  const t0 = performance.now();
  action(frame._bench);

  // Wait for DOM to settle (requestAnimationFrame + 1 frame)
  await new Promise(resolve => {
    frame.requestAnimationFrame(() => {
      frame.requestAnimationFrame(() => resolve());
    });
  });

  const elapsed = performance.now() - t0;

  if (teardown) {
    await sleep(16);
    teardown(frame._bench);
    await sleep(16);
  }

  return elapsed;
}

async function runTest(testId, setup, action, teardown) {
  const whatFrame = getFrame('what');
  const reactFrame = getFrame('react');

  await waitForBench(whatFrame);
  await waitForBench(reactFrame);

  // Warmup
  for (let i = 0; i < WARMUP_RUNS; i++) {
    await measureOp(whatFrame, setup, action, teardown);
    await measureOp(reactFrame, setup, action, teardown);
  }

  // Measured runs
  const whatTimes = [];
  const reactTimes = [];

  for (let i = 0; i < MEASURED_RUNS; i++) {
    whatTimes.push(await measureOp(whatFrame, setup, action, teardown));
    reactTimes.push(await measureOp(reactFrame, setup, action, teardown));
  }

  // Median
  whatTimes.sort((a, b) => a - b);
  reactTimes.sort((a, b) => a - b);
  const whatMedian = whatTimes[Math.floor(whatTimes.length / 2)];
  const reactMedian = reactTimes[Math.floor(reactTimes.length / 2)];

  return { what: whatMedian, react: reactMedian };
}

function updateRow(testId, what, react) {
  const row = document.getElementById('row-' + testId);
  row.querySelector('.what-val').textContent = what.toFixed(1);
  row.querySelector('.react-val').textContent = react.toFixed(1);

  const speedup = react / what;
  const speedupEl = row.querySelector('.speedup');

  if (speedup > 1.1) {
    speedupEl.innerHTML = `<span class="faster">${speedup.toFixed(1)}x</span>`;
  } else if (speedup < 0.9) {
    speedupEl.innerHTML = `<span class="slower">${(1/speedup).toFixed(1)}x slower</span>`;
  } else {
    speedupEl.innerHTML = `<span class="neutral">~same</span>`;
  }

  // Bars
  const maxVal = Math.max(what, react);
  const bars = row.querySelectorAll('.bar');
  bars[0].style.width = (what / maxVal * 100) + 'px';
  bars[1].style.width = (react / maxVal * 100) + 'px';

  results[testId] = { what, react, speedup };
}

function updateSummary() {
  const vals = Object.values(results);
  if (vals.length === 0) return;

  const speedups = vals.map(v => v.react / v.what);
  const avg = speedups.reduce((a, b) => a + b, 0) / speedups.length;
  const won = speedups.filter(s => s > 1.05).length;
  const max = Math.max(...speedups);

  document.getElementById('summary').style.display = '';
  document.getElementById('avg-speedup').textContent = avg.toFixed(1) + 'x';
  document.getElementById('tests-won').textContent = won + '/' + vals.length;
  document.getElementById('max-speedup').textContent = max.toFixed(1) + 'x';
}

const tests = {
  create1k: {
    setup: b => b.clear(),
    action: b => b.run(),
    teardown: null,
  },
  replace: {
    setup: b => b.run(),
    action: b => b.run(),
    teardown: b => b.clear(),
  },
  update10k: {
    setup: b => b.runLots(),
    action: b => b.update(),
    teardown: b => b.clear(),
  },
  select: {
    setup: b => b.run(),
    action: b => b.selectRow(2),
    teardown: b => b.clear(),
  },
  swap: {
    setup: b => b.run(),
    action: b => b.swapRows(),
    teardown: b => b.clear(),
  },
  clear: {
    setup: b => b.run(),
    action: b => b.clear(),
    teardown: null,
  },
  create10k: {
    setup: b => b.clear(),
    action: b => b.runLots(),
    teardown: b => b.clear(),
  },
  append: {
    setup: b => b.runLots(),
    action: b => b.add(),
    teardown: b => b.clear(),
  },
};

const testOrder = ['create1k', 'replace', 'update10k', 'select', 'swap', 'clear', 'create10k', 'append'];

async function runAllBenchmarks() {
  const btns = document.querySelectorAll('button');
  btns.forEach(b => b.disabled = true);

  const progress = document.getElementById('progress');
  const status = document.getElementById('status');

  for (let i = 0; i < testOrder.length; i++) {
    const id = testOrder[i];
    const test = tests[id];
    const pct = ((i / testOrder.length) * 100).toFixed(0);
    progress.style.width = pct + '%';
    status.textContent = `Running: ${id} (${i + 1}/${testOrder.length})...`;

    try {
      const { what, react } = await runTest(id, test.setup, test.action, test.teardown);
      updateRow(id, what, react);
    } catch (e) {
      status.textContent = `Error on ${id}: ${e.message}`;
      console.error(e);
    }
  }

  progress.style.width = '100%';
  status.textContent = 'All benchmarks complete!';
  updateSummary();

  btns.forEach(b => b.disabled = false);
}

async function runSingleTest(id) {
  const status = document.getElementById('status');
  status.textContent = `Running: ${id}...`;

  try {
    const test = tests[id];
    const { what, react } = await runTest(id, test.setup, test.action, test.teardown);
    updateRow(id, what, react);
    status.textContent = `${id} complete! What: ${what.toFixed(1)}ms, React: ${react.toFixed(1)}ms`;
    updateSummary();
  } catch (e) {
    status.textContent = `Error: ${e.message}`;
  }
}
</script>
</body>
</html>
