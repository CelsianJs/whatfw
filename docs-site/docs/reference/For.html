<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>&lt;For&gt; â€” What Framework</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <nav>
    <div class="nav-left">
      <a href="../" class="logo">What <span class="logo-badge">v0.5.3</span></a>
      <div class="nav-links">
        <a href="../learn/">Learn</a>
        <a href="./" class="active">Reference</a>
        <a href="../tutorial/">Tutorial</a>
      </div>
    </div>
  </nav>

  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Reactivity</div>
        <ul class="sidebar-links">
          <li><a href="./signal.html">signal()</a></li>
          <li><a href="./computed.html">computed()</a></li>
          <li><a href="./effect.html">effect()</a></li>
          <li><a href="./batch.html">batch()</a></li>
          <li><a href="./untrack.html">untrack()</a></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Components</div>
        <ul class="sidebar-links">
          <li><a href="./h.html">h()</a></li>
          <li><a href="./mount.html">mount()</a></li>
          <li><a href="./Show.html">&lt;Show&gt;</a></li>
          <li><a href="./For.html" class="active">&lt;For&gt;</a></li>
        </ul>
      </div>
    </aside>

    <main class="content">
      <div class="content-wrapper">
        <div class="content-inner">
          <h1>&lt;For&gt;</h1>
          <p class="subtitle">Efficient list rendering with automatic key detection and keyed reconciliation.</p>

<pre><code>&lt;<span class="function">For</span> each={list} fallback={emptyState}&gt;
  {(item, index) =&gt; &lt;Item /&gt;}
&lt;/<span class="function">For</span>&gt;</code></pre>

          <h2 id="props">Props</h2>
          <table>
            <thead>
              <tr><th>Prop</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><code>each</code></td>
                <td><code>T[] | (() =&gt; T[])</code></td>
                <td>The array to iterate over. Can be a signal or a plain array.</td>
              </tr>
              <tr>
                <td><code>fallback</code></td>
                <td><code>VNode | null</code></td>
                <td>Optional. What to render when the array is empty or <code>null</code>. Defaults to <code>null</code>.</td>
              </tr>
              <tr>
                <td><code>children</code></td>
                <td><code>(item: T, index: number) =&gt; VNode</code></td>
                <td>A render function that receives each item and its index. Must return a VNode.</td>
              </tr>
            </tbody>
          </table>

          <h2 id="returns">Returns</h2>
          <p>An array of VNodes (one per item), or the <code>fallback</code> if the list is empty.</p>

          <h2 id="usage">Usage</h2>

          <h3>Basic List</h3>
<pre><code><span class="keyword">import</span> { For, signal } <span class="keyword">from</span> <span class="string">'what-framework'</span>;

<span class="keyword">const</span> items = <span class="function">signal</span>([
  { id: <span class="number">1</span>, name: <span class="string">'Apple'</span> },
  { id: <span class="number">2</span>, name: <span class="string">'Banana'</span> },
  { id: <span class="number">3</span>, name: <span class="string">'Cherry'</span> },
]);

&lt;ul&gt;
  &lt;For each={items}&gt;
    {(item, index) =&gt; (
      &lt;li key={item.id}&gt;
        {index + <span class="number">1</span>}. {item.name}
      &lt;/li&gt;
    )}
  &lt;/For&gt;
&lt;/ul&gt;</code></pre>

          <h3>Empty State</h3>
<pre><code>&lt;For each={items} fallback={&lt;p&gt;No items yet.&lt;/p&gt;}&gt;
  {item =&gt; &lt;li&gt;{item.name}&lt;/li&gt;}
&lt;/For&gt;</code></pre>

          <h3>With Reactive Updates</h3>
<pre><code><span class="keyword">const</span> todos = <span class="function">signal</span>([]);

<span class="comment">// Add a todo</span>
todos.set(t =&gt; [...t, { id: Date.now(), text: <span class="string">'New item'</span> }]);

<span class="comment">// Remove a todo</span>
todos.set(t =&gt; t.filter(item =&gt; item.id !== targetId));

<span class="comment">// The list updates automatically</span>
&lt;For each={todos}&gt;
  {todo =&gt; (
    &lt;div key={todo.id}&gt;
      &lt;span&gt;{todo.text}&lt;/span&gt;
      &lt;button onClick={() =&gt; removeTodo(todo.id)}&gt;Delete&lt;/button&gt;
    &lt;/div&gt;
  )}
&lt;/For&gt;</code></pre>

          <h3>Primitive Lists</h3>
<pre><code><span class="keyword">const</span> tags = <span class="function">signal</span>([<span class="string">'react'</span>, <span class="string">'vue'</span>, <span class="string">'what'</span>]);

&lt;For each={tags}&gt;
  {tag =&gt; &lt;span className=<span class="string">"tag"</span>&gt;{tag}&lt;/span&gt;}
&lt;/For&gt;
<span class="comment">// For primitive items, the item value itself is used as the key</span></code></pre>

          <h2 id="auto-keys">Automatic Key Detection</h2>
          <p><code>For</code> automatically detects keys to enable efficient keyed reconciliation:</p>
          <ul>
            <li>If the VNode returned by the render function already has a <code>key</code> prop, it is used as-is.</li>
            <li>If the item is an object with an <code>id</code> property, <code>item.id</code> is used as the key.</li>
            <li>If the item is an object with a <code>key</code> property, <code>item.key</code> is used.</li>
            <li>If the item is a string or number, the item value itself is used as the key.</li>
          </ul>
          <p>This means you often do not need to provide a <code>key</code> prop explicitly if your data has standard <code>id</code> fields.</p>

          <h2 id="how-it-works">How It Works</h2>
          <p><code>For</code> is a component function that:</p>
          <ol>
            <li>Reads the <code>each</code> prop (calling it if it is a signal)</li>
            <li>Returns <code>fallback</code> if the list is empty or null</li>
            <li>Maps each item through the render function (first child)</li>
            <li>Attaches auto-detected keys to VNodes that lack explicit keys</li>
            <li>Returns the array of VNodes for the reconciler to diff</li>
          </ol>
          <p>What's reconciler uses keyed reconciliation with a Longest Increasing Subsequence (LIS) algorithm for O(n log n) minimal DOM moves.</p>

          <h2 id="notes">Notes</h2>
          <ul>
            <li>The <code>children</code> of <code>&lt;For&gt;</code> must be a single render function, not JSX elements. If a non-function is passed, a console warning is displayed.</li>
            <li>Always provide stable keys (like <code>id</code> fields) for list items. Avoid using array indices as keys when items can be reordered or removed.</li>
            <li>For static arrays known at render time, plain <code>.map()</code> works fine. Use <code>&lt;For&gt;</code> when the list is reactive (a signal).</li>
            <li>The <code>each</code> prop accepts both signals and plain arrays. If a signal is passed, <code>For</code> calls it to read the current array.</li>
          </ul>

          <div class="page-nav">
            <a href="./Show.html">
              <span class="label">Previous</span>
              <span class="title">&lt;Show&gt;</span>
            </a>
            <div></div>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>
</html>
